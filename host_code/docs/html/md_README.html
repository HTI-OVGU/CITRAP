<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AXIDMA: AXIDMA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AXIDMA
   </div>
   <div id="projectbrief">AXI DMA driver for linux</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AXIDMA </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This repository contains a simple implementation of the AXI DMA (Direct Memory Access) driver, configured to read data from memory and stream it to AXI peripherals.</p><ul>
<li>Simple Mode Configuration: Streams data from memory to peripherals using a straightforward setup.</li>
<li>Lightweight Design: Minimal configuration for ease of use in basic applications.</li>
<li>Uses XDMA to write/read from device</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Example usage in xaxidma_simple_poll</h2>
<ul>
<li>To understand Memory mapped data transfer usage to write and read from memory, refer to <a href="md_MMDT.html">MMDT.md</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md9"></a>
Note:</h3>
<ul>
<li><a class="el" href="xparameters_8h.html">xparameters.h</a> is generated while creating design in vivado. Do not modify. It contains AXIDMA configurations.</li>
<li><a class="el" href="xaxidma__g_8cpp.html">xaxidma_g.cpp</a> has to be updated based on the <a class="el" href="xparameters_8h.html">xparameters.h</a> configurations.</li>
<li>To understand simple transfer function usage, refer to <a class="el" href="xaxidma_8cpp.html">xaxidma.cpp</a></li>
<li>As of December 2024, the maximum transfer length for AXIDMA transfer, configurable in vivado is 26 bit width (67108863 bytes).</li>
</ul>
<h3><a class="anchor" id="autotoc_md10"></a>
Things to Configure:</h3>
<ul>
<li>Below configurables in <a class="el" href="xaxidma__simple__poll_8cpp.html">xaxidma_simple_poll.cpp</a><ul>
<li>MEM_BASE_ADDR: Base address of memory</li>
<li>MAX_PKT_LEN: Total bytes to transfer</li>
<li>TX_BUFFER_BASE: Source address for transfer</li>
<li>RX_BUFFER_BASE: Destination address for transfer</li>
<li>RX_BUFFER_HIGH: Destination last address</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">int main()</div>
<div class="line">{</div>
<div class="line">    int Status;</div>
<div class="line"> </div>
<div class="line">    printf(&quot;\r\n--- Entering main() --- \r\n&quot;);</div>
<div class="line">    SingleLineMMDT singleLineMMDT;</div>
<div class="line">    // to print the values being written to/ read from memory</div>
<div class="line">    printData = true;</div>
<div class="line">    // to print the values being written to/ read from memory </div>
<div class="line">    // while they are in the buffer. prints byte by byte</div>
<div class="line">    printBufferData = false;</div>
<div class="line">    // ParallelMMDT parallelMMDT;</div>
<div class="line">    const int32_t packet_length = MAX_PKT_LEN/sizeof(dataType);</div>
<div class="line">    u64 TxBufferPtr = TX_BUFFER_BASE;</div>
<div class="line">    u64 RxBufferPtr = RX_BUFFER_BASE;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    # ************************************************Write data to memory via XDMA************************************************</div>
<div class="line">    std::vector&lt;dataType&gt; data;</div>
<div class="line">    for (int i = 0; i &lt; packet_length; i++) {</div>
<div class="line">        data.push_back(i);</div>
<div class="line">    }</div>
<div class="line">    // Used for writing data to memory</div>
<div class="line">    int rc = singleLineMMDT.sendToFPGA(data, packet_length, TxBufferPtr, XDMA_DEVICE_NAME_WRITE);</div>
<div class="line">    if (rc &lt; 0) {</div>
<div class="line">        std::cerr &lt;&lt; &quot;sendToFPGA failed&quot; &lt;&lt; TxBufferPtr &lt;&lt; std::endl;</div>
<div class="line">        return EXIT_FAILURE;</div>
<div class="line">    }</div>
<div class="line">    # ************************************************axidma configuration ************************************************</div>
<div class="line">    // Initial configuration for setting up axidma</div>
<div class="line">    Status = XAxiDma_Configuration(XPAR_AXI_DMA_0_BASEADDR);</div>
<div class="line">    if (Status != XST_SUCCESS) {</div>
<div class="line">        printf(&quot;XAxiDma_Configuration Failed\r\n&quot;);</div>
<div class="line">        return XST_FAILURE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    # ************************************************axidma simple transfer************************************************</div>
<div class="line">    // Based on IPCore configuration, use DEVICE_TO_DMA or DMA_TO_DEVICE</div>
<div class="line">    // This example shows usage with both channels</div>
<div class="line">    for (Index = 0; Index &lt; Tries; Index ++) {</div>
<div class="line"> </div>
<div class="line">        Status = XAxiDma_SimpleTransfer(&amp;AxiDma, (UINTPTR) RxBufferPtr,</div>
<div class="line">                        MAX_PKT_LEN, XAXIDMA_DEVICE_TO_DMA);</div>
<div class="line"> </div>
<div class="line">        if (Status != XST_SUCCESS) {</div>
<div class="line">            printf(&quot;XAxiDma_SimpleTransfer Failed\r\n&quot;);</div>
<div class="line">            return XST_FAILURE;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        Status = XAxiDma_SimpleTransfer(&amp;AxiDma, (UINTPTR) TxBufferPtr,</div>
<div class="line">                        MAX_PKT_LEN, XAXIDMA_DMA_TO_DEVICE);</div>
<div class="line"> </div>
<div class="line">        if (Status != XST_SUCCESS) {</div>
<div class="line">            printf(&quot;XAxiDma_SimpleTransfer Failed\r\n&quot;);</div>
<div class="line">            return XST_FAILURE;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        /*Wait till tranfer is done or 1usec * 10^6 iterations of timeout occurs*/</div>
<div class="line">        while (TimeOut) {</div>
<div class="line">            if (!(XAxiDma_Busy(&amp;AxiDma, XAXIDMA_DEVICE_TO_DMA)) &amp;&amp;</div>
<div class="line">                !(XAxiDma_Busy(&amp;AxiDma, XAXIDMA_DMA_TO_DEVICE))) {</div>
<div class="line">                break;</div>
<div class="line">            }</div>
<div class="line">            TimeOut--;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    # ************************************************Read data from destination address via XDMA************************************************</div>
<div class="line">    // Used to read data from memory. </div>
<div class="line">    // For our test case, we write to a (source address)memory, invoke axidma transfer, </div>
<div class="line">    // and read from the (destination address)memory configured on axidma registers.</div>
<div class="line">    std::vector&lt;dataType&gt; outData;</div>
<div class="line">    int read_rc = singleLineMMDT.readFromFPGA(outData, packet_length, RxBufferPtr, XDMA_DEVICE_NAME_READ);</div>
<div class="line">    if (read_rc &lt; 0) {</div>
<div class="line">        std::cerr &lt;&lt; &quot;readFromFPGA failed -----------------------&quot; &lt;&lt; RxBufferPtr &lt;&lt; std::endl;;</div>
<div class="line">        return EXIT_FAILURE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(&quot;--- Success: Exiting main() --- \r\n&quot;);</div>
<div class="line"> </div>
<div class="line">    return XST_SUCCESS;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
Installation</h1>
<ol type="1">
<li>Clone the repository: <div class="fragment"><div class="line">git clone https://github.com/nandhishtr/axidma.git</div>
</div><!-- fragment --> </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
